---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Sources } from "../../components/Sources.tsx";

export async function getStaticPaths() {
  const essays = await getCollection("essays", ({ data }) => !data.draft);

  return essays.map((post) => {
    // how-computers-work/index.mdx -> how-computers-work
    const slug = post.id.split("/")[0];
    return {
      params: { slug },
      props: { post, slug },
    };
  });
}

const { post, slug } = Astro.props;
const { Content } = await post.render();

// OG image URL for this post
const ogImage = `/${slug}/index.png`;
---

<Layout
  title={post.data.title}
  description={post.data.description}
  ogImage={ogImage}
>
  <main class="max-w-2xl mx-auto px-4 sm:px-6 py-12 sm:py-16 md:py-24">
    <article class="prose dark:prose-invert prose-neutral max-w-none">
      <h2 class="mb-0">{post.data.title}</h2>
      <p class="text-neutral-500 dark:text-neutral-400 -mt-2 pt-0 mb-8">
        By Tadas Petra
      </p>
      {post.data.sources && <Sources sources={post.data.sources} client:load />}
      <Content />
    </article>
  </main>
</Layout>
