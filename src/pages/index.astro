---
import Layout from "../layouts/Layout.astro";
import EntryCard from "../components/EntryCard.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts", ({ data }) => !data.draft);

// Sort by date (newest first) and extract slug from id
const sortedPosts = posts
  .sort((a, b) => b.data.pubDatetime.valueOf() - a.data.pubDatetime.valueOf())
  .map((post) => {
    // Handle both flat files (2024/post-name.md) and folder-based (essays/how-computers-work/index.mdx)
    const parts = post.id.split("/");
    const filename = parts.pop() ?? "";
    // Remove .md or .mdx extension
    const basename = filename.replace(/\.mdx?$/, "");
    // If basename is "index", use the parent folder name as slug
    const slug = basename === "index" ? (parts.pop() ?? post.id) : basename;
    return {
      title: post.data.title,
      slug,
    };
  });
---

<Layout
  title="Tadas Petra"
  description="I get energy from building useful products and teaching what I learn along the way."
  ogImage="/og.png"
>
  <main class="max-w-2xl mx-auto px-4 sm:px-6 py-12 sm:py-16 md:py-24">
    <div
      class="flex flex-wrap items-center justify-between gap-3 mb-10 sm:mb-14 sm:flex-nowrap"
    >
      <div class="flex items-center gap-4 sm:gap-5">
        <img
          src="/bw-pic.png"
          alt="Tadas Petra"
          class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg object-cover grayscale"
        />
        <div>
          <h1 class="mb-0 leading-none pt-2">tadas petra</h1>
          <p
            class="text-sm text-neutral-400 dark:text-neutral-500 -mt-1 flex items-center gap-1"
          >
            tah-dahs pet-rah
            <button
              id="play-pronunciation"
              class="inline-flex items-center justify-center text-neutral-400 hover:text-neutral-600 dark:text-neutral-500 dark:hover:text-neutral-300 transition-colors"
              aria-label="Play name pronunciation"
              title="Play pronunciation"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              </svg>
            </button>
          </p>
          <audio id="name-audio" src="/tadas-petra.mp3" preload="none"></audio>
        </div>
      </div>

      <p class="text-base sm:text-lg w-full sm:w-auto">
        <a href="/resume.pdf" download>resume</a>
      </p>
    </div>

    <div class="space-y-5 sm:space-y-6 text-base sm:text-lg leading-relaxed">
      <!-- <p>
        I find joy in building quality products and sharing how I do it. My goal
        is to lower barriers to entry for developers to build cool things.
      </p> -->

      <p class="text-neutral-500 dark:text-neutral-400">
        I get energy from building useful products and teaching what I learn
        along the way. My purpose is to open doors for anyone who wants to
        build.
      </p>

      <h2 class="mt-16">what i am working on</h2>
      <div class="space-y-0">
        <EntryCard
          href="https://elevenlabs.io"
          title="ElevenLabs"
          description="Developer Relations Engineer"
          logo="/logos/elevenlabs.svg"
          class="h-4 -ml-0.5 pb-1"
        />
        <EntryCard
          href="https://hungrimind.com"
          title="Hungrimind"
          description="Interactive learning platform for Flutter and Dart."
          logo="/logos/hungrimind.png"
          class="h-5"
        />
        <EntryCard
          href="https://youtube.com/@tadaspetra"
          title="Youtube"
          description="Sharing what I learn."
          logo="/logos/youtube.svg"
          class="h-5 pb-1"
        />
      </div>

      <h2 class="mt-16">places i have worked</h2>
      <div class="space-y-0">
        <EntryCard
          href="https://agora.io"
          title="Agora"
          description="Senior Developer Advocate leading content and product."
          logo="/logos/agora.svg"
          class="h-4"
        />
        <EntryCard
          href="https://zerotomastery.io/courses/flutter-bootcamp/"
          title="Zero To Mastery"
          description="Instructor for Flutter Bootcamp."
          logo="/logos/ztm.svg"
          logoText="Zero To Mastery"
          class="h-3"
        />
        <EntryCard
          href="https://international.com"
          title="International"
          description="Senior Software Low Level Engineer."
          logo="/logos/international.png"
          class="h-4 pb-1"
        />
      </div>

      <h2 class="mt-16">things i am proud of</h2>
      <div class="space-y-0">
        <EntryCard
          href="https://developers.google.com/profile/u/107281012378384773706"
          title="GDE"
          description="Google Developer Expert for Flutter and Dart since 2021."
          logo="/logos/google.svg"
          class="h-5"
        />
      </div>

      <h2 class="mt-16">my writing</h2>
      <div class="space-y-0">
        {
          sortedPosts.map((post) => (
            <a
              href={`/${post.slug}`}
              class="plain-link block px-4 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors text-sm sm:text-base"
            >
              {post.title}
            </a>
          ))
        }
      </div>
    </div>
  </main>

  <script>
    const playBtn = document.getElementById("play-pronunciation");
    const audio = document.getElementById("name-audio") as HTMLAudioElement;

    playBtn?.addEventListener("click", () => {
      audio.currentTime = 0;
      audio.play();
    });
  </script>
</Layout>
